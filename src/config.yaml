auto_tasks:
  # aggregate sources and build all
  default:
    - action: aggregate
    - action: lint
      kwargs:
        files:
          - src/blocklist/
          - src/aggregations/
        auto_fix: true
        sort_rules: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
        cross_files: true
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
          - src/blocklist/nearly-content-farms.txt
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
        cross_files: true
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/bad-cloners.txt
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
        cross_files: true
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
          - src/aggregations/content-farms/
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
        cross_files: true
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
          - src/blocklist/nearly-content-farms.txt
          - src/aggregations/nearly-content-farms/
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
          - src/blocklist/nearly-content-farms.txt
        cross_files: true
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/bad-cloners.txt
          - src/aggregations/bad-cloners/
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/bad-cloners.txt
        cross_files: true
        auto_fix: true
    - action: build

  # lint all general blacklists
  lint:
    - action: lint
      kwargs:
        files:
          - src/blocklist/
        auto_fix: true
        sort_rules: true

  # uniquify all general blacklists
  uniquify:
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
        advanced: true
        auto_fix: true
    - action: uniquify
      kwargs:
        files:
          - src/blocklist/not-content-farms.txt
          - src/blocklist/content-farms.txt
          - src/blocklist/nearly-content-farms.txt
          - src/blocklist/bad-cloners.txt
          - src/blocklist/sns-content-farms.txt
        auto_fix_excludes:
          - src/blocklist/not-content-farms.txt
        advanced: true
        cross_files: true
        auto_fix: true

aggregate:
  - name: xxcnxx
    homepage: https://github.com/mxt305/smashXxcnxx
    source: https://raw.githubusercontent.com/mxt305/smashXxcnxx/main/filters/xxcnxx-list.json
    dest: src/aggregations/content-farms/xxcnxx-list.txt
    type: domains_json
  - name: penzai
    homepage: https://github.com/wdmpa/content-farm-list
    source: https://raw.githubusercontent.com/wdmpa/content-farm-list/main/domains/spam/g.penzai.com.txt
    dest: src/aggregations/content-farms/g.penzai.com.txt
    type: ublacklist
  - name: cxyzjd
    homepage: https://github.com/wdmpa/content-farm-list
    source: https://raw.githubusercontent.com/wdmpa/content-farm-list/main/domains/spam/cxyzjd.txt
    dest: src/aggregations/content-farms/cxyzjd.txt
    type: ublacklist
  - name: ksou
    homepage: https://github.com/wdmpa/content-farm-list
    source: https://raw.githubusercontent.com/wdmpa/content-farm-list/main/domains/spam/ksou.cc.txt
    dest: src/aggregations/content-farms/ksou.cc.txt
    type: ublacklist
  - name: www6532033
    homepage: https://github.com/wdmpa/content-farm-list
    source: https://raw.githubusercontent.com/wdmpa/content-farm-list/main/domains/spam/www.6532033.com.txt
    dest: src/aggregations/content-farms/www.6532033.com.txt
    type: ublacklist
  - name: GHHbD
    homepage: https://github.com/cobaltdisco/Google-Chinese-Results-Blocklist
    source: https://raw.githubusercontent.com/cobaltdisco/Google-Chinese-Results-Blocklist/master/GHHbD_perma_ban_list.txt
    dest: src/aggregations/nearly-content-farms/google-chinese-results-blocklist.txt
    type: domains_txt
  - name: ublSoT
    homepage: https://github.com/arosh/ublacklist-stackoverflow-translation
    source: https://raw.githubusercontent.com/arosh/ublacklist-stackoverflow-translation/master/uBlacklist.txt
    dest: src/aggregations/bad-cloners/ublacklist-stackoverflow-translation.txt
    type: ublacklist
  - name: ublGhT
    homepage: https://github.com/arosh/ublacklist-github-translation
    source: https://raw.githubusercontent.com/arosh/ublacklist-github-translation/master/uBlacklist.txt
    dest: src/aggregations/bad-cloners/ublacklist-github-translation.txt
    type: ublacklist
  - name: wdmpaMtSo
    homepage: https://github.com/wdmpa/content-farm-list
    source: https://raw.githubusercontent.com/wdmpa/content-farm-list/main/domains/machine-translated/stackoverflow.txt
    dest: src/aggregations/bad-cloners/wdmpa-machine-translated-stackoverflow.txt
    type: ublacklist

build:
  - source:
      - src/blocklist/content-farms.txt
      - src/aggregations/content-farms/
    publish: docs/files/blocklist/content-farms.txt
    data:
      headers: |
        Title: Content Farm Filters
        Description: Filter for general content farms, mostly in Chinese.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist/content-farms.txt
      schemes: &content_farms_schemes
        xuite: &grouping_regex_scheme
          value: /^https?://(?:(?:m\.)?(?:[bv]log|photo)\.xuite\.net|m\.xuite\.net/blog)/(?:{value})(?=[/?#]|$)/
          escape: regex
          grouping: "|"
          max: 2097152
        udn:
          <<: *grouping_regex_scheme
          value: /^https?://(?:blog|album)\.udn\.com/(?:mobile/)?(?:{value})(?=[/?#]|$)/
        pchome:
          <<: *grouping_regex_scheme
          value: /^https?://mypaper\.(?:m\.)?pchome\.com\.tw/(?:{value})(?=[/?#]|$)/
        domain-part:
          <<: *grouping_regex_scheme
          value: /https?://(?:[\w-]+\.)*(?:{value})(?:\.[\w-]+)*(?=[:/?#]|$)/
        domain-path:
          <<: *grouping_regex_scheme
          value: /https?://(?:www\.)?(?:{value})(?=[/?#]|$)/

  - source:
      - src/blocklist/nearly-content-farms.txt
      - src/aggregations/nearly-content-farms/
    publish: docs/files/blocklist/nearly-content-farms.txt
    data:
      headers: |
        Title: Nearly Content Farm Filters
        Description: Filter for content-farm-like sites, mostly in Chinese.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist/nearly-content-farms.txt
      schemes: *content_farms_schemes

  - source: src/blocklist/sns-content-farms.txt
    publish: docs/files/blocklist/sns-content-farms.txt
    data:
      headers: |
        Title: SNS Content Farm Filters
        Description: Filter for content-farm-like or related social network service (SNS) URLs, mostly in Chinese.
            This may not work well for all cases as many things cannot be fully determined by URL.
            This list is mostly regex-based and may have a negative effect on performance.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist/sns-content-farms.txt
      schemes: &sns_content_farms_schemes
        facebook:
          <<: *grouping_regex_scheme
          value: /^https?://(?:(?:[\w-]+\.)?facebook\.com(?:/(?:pg/)?|\b[^#]+#!/)|(?:fb|m)\.(?:com|me)/)(?:{value})(?=[/?#]|$)/
        facebook-num:
          <<: *grouping_regex_scheme
          value: /^https?://(?:(?:[\w-]+\.)?facebook\.com(?:/(?:pg/)?|\b[^#]+#!/)|(?:fb|m)\.(?:com|me)/)(?:[^?#]+/)?(?:[^/?#]+-)?(?:{value})(?=[/?#]|$)/
        facebook-group:
          <<: *grouping_regex_scheme
          value: /^https?://(?:(?:[\w-]+\.)?facebook\.com(?:/|\b[^#]+#!/)|(?:fb|m)\.(?:com|me)/)groups/(?:{value})(?=[/?#]|$)/
        twitter:
          <<: *grouping_regex_scheme
          value: /^https?://(?:\w+\.)?twitter\.com/(?:{value})(?=[/?#]|$)/
        youtube-channel:
          <<: *grouping_regex_scheme
          value: /^https?://(?:\w+\.)?youtube\.com/channel/(?:{value})(?=[/?#]|$)/
        youtube-user:
          <<: *grouping_regex_scheme
          value: /^https?://(?:\w+\.)?youtube\.com/user/(?:{value})(?=[/?#]|$)/
        instagram:
          <<: *grouping_regex_scheme
          value: /^https?://(?:www\.)?instagram\.com/(?:{value})(?=[/?#]|$)/
        pinterest:
          <<: *grouping_regex_scheme
          value: /^https?://(?:www\.)?pinterest(?:\.[a-z]+)+/(?:{value})(?=[/?#]|$)/
        plurk:
          <<: *grouping_regex_scheme
          value: /^https?://(?:www\.)?plurk\.com/(?:m/p/)?(?:{value})(?=[/?#]|$)/
        line-page:
          <<: *grouping_regex_scheme
          value: /^https?://page\.line\.me/(?:{value})(?=[/?#]|$)/
        line-timeline:
          <<: *grouping_regex_scheme
          value: /^https?://timeline\.line\.me/(?:\w+?)/(?:{value})(?=[/?#]|$)/
        haokan-author:
          <<: *grouping_regex_scheme
          value: /https?://(?:haokan|sv)\.baidu\.com/author/(?:{value})(?=[/?#]|$)/

  - source:
      - src/blocklist/bad-cloners.txt
      - src/aggregations/bad-cloners/
    publish: docs/files/blocklist/bad-cloners.txt
    data:
      headers: |
        Title: Bad Cloners
        Description: Filter for cloner sites that are mostly free of copyright issue since the source site
            is copyleft or copyfree, but provide only trivial layout change or poor-quality bot translation
            and are thus spam-like.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist/bad-cloners.txt
      schemes: *content_farms_schemes

  - source: src/blocklist/fake-news.txt
    publish: docs/files/blocklist/fake-news.txt
    data:
      headers: |
        Title: Fake News Filters
        Description: Filter for fake news sites. (For reference)
            This list is slightly organized from several sources only and is NOT actively maintained.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist/fake-news.txt
      schemes: *content_farms_schemes

  - source: src/blocklist/scam-sites.txt
    publish: docs/files/blocklist/scam-sites.txt
    data:
      headers: |
        Title: Scam Sites Filters
        Description: Filter for scam sites. (For reference)
            This list is slightly organized from the database of ContenFarm Filter and Critic
            (https://github.com/xianshengyou8/filterfarm) and is NOT actively maintained.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist/scam-sites.txt
      schemes: *content_farms_schemes

  - source:
      - src/blocklist/content-farms.txt
      - src/aggregations/content-farms/
    publish: docs/files/blocklist-hosts/content-farms.txt
    type: hosts
    data:
      headers: |
        Title: Content Farm Filters
        Description: Filter for general content farms, mostly in Chinese.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-hosts/content-farms.txt
      processors:
        - type: domain
          pattern: blogspot\.\*$
          replacement: blogspot.com

  - source:
      - src/blocklist/nearly-content-farms.txt
      - src/aggregations/nearly-content-farms/
    publish: docs/files/blocklist-hosts/nearly-content-farms.txt
    type: hosts
    data:
      headers: |
        Title: Nearly Content Farm Filters
        Description: Filter for content-farm-like sites, mostly in Chinese.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-hosts/nearly-content-farms.txt

  - source:
      - src/blocklist/bad-cloners.txt
      - src/aggregations/bad-cloners/
    publish: docs/files/blocklist-hosts/bad-cloners.txt
    type: hosts
    data:
      headers: |
        Title: Bad Cloners
        Description: Filter for cloner sites that are mostly free of copyright issue since the source site
            is copyleft or copyfree, but provide only trivial layout change or poor-quality bot translation
            and are thus spam-like.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-hosts/bad-cloners.txt

  - source: src/blocklist/fake-news.txt
    publish: docs/files/blocklist-hosts/fake-news.txt
    type: hosts
    data:
      headers: |
        Title: Fake News Filters
        Description: Filter for fake news sites. (For reference)
            This list is slightly organized from several sources only and is NOT actively maintained.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-hosts/fake-news.txt

  - source: src/blocklist/scam-sites.txt
    publish: docs/files/blocklist-hosts/scam-sites.txt
    type: hosts
    data:
      headers: |
        Title: Scam Sites Filters
        Description: Filter for scam sites. (For reference)
            This list is slightly organized from the database of ContenFarm Filter and Critic
            (https://github.com/xianshengyou8/filterfarm) and is NOT actively maintained.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-hosts/scam-sites.txt

  - source:
      - src/blocklist/content-farms.txt
      - src/aggregations/content-farms/
    publish: docs/files/blocklist-ubo/content-farms.txt
    type: ubo
    data:
      headers: |
        Title: Content Farm Filters
        Description: Filter for general content farms, mostly in Chinese.
        Expires: 3 days
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ubo/content-farms.txt
      processors: &content_farms_processors_ubo
        - type: domain
          pattern: ^\*\.([\w.-]+)$
          replacement: domain-suffix:\1
      schemes: &content_farms_schemes_ubo
        <<: *content_farms_schemes
        domain-part:
          value: "||{value}^\n||{value}.*^$document"
          mode: raw
        domain-path:
          value: "||{value}^$document"
          mode: raw
        domain-suffix:
          <<: *grouping_regex_scheme
          value: /https?://(?:www\.|(?!www\.))[\w.-]+\.(?:{value})(?=[:/?#]|$)/

  - source:
      - src/blocklist/nearly-content-farms.txt
      - src/aggregations/nearly-content-farms/
    publish: docs/files/blocklist-ubo/nearly-content-farms.txt
    type: ubo
    data:
      headers: |
        Title: Nearly Content Farm Filters
        Description: Filter for content-farm-like sites, mostly in Chinese.
        Expires: 3 days
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ubo/nearly-content-farms.txt
      processors: *content_farms_processors_ubo
      schemes: *content_farms_schemes_ubo

  - source: src/blocklist/sns-content-farms.txt
    publish: docs/files/blocklist-ubo/sns-content-farms.txt
    type: ubo
    data:
      headers: |
        Title: SNS Content Farm Filters
        Description: Filter for content-farm-like or related social network service (SNS) URLs, mostly in Chinese.
            This may not work well for all cases as many things cannot be fully determined by URL.
            This list is mostly regex-based and may have a negative effect on performance.
        Expires: 3 days
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ubo/sns-content-farms.txt
      schemes:
        <<: *sns_content_farms_schemes

  - source:
      - src/blocklist/bad-cloners.txt
      - src/aggregations/bad-cloners/
    publish: docs/files/blocklist-ubo/bad-cloners.txt
    type: ubo
    data:
      headers: |
        Title: Bad Cloners
        Description: Filter for cloner sites that are mostly free of copyright issue since the source site
            is copyleft or copyfree, but provide only trivial layout change or poor-quality bot translation
            and are thus spam-like.
        Expires: 3 days
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ubo/bad-cloners.txt
      processors: *content_farms_processors_ubo
      schemes: *content_farms_schemes_ubo

  - source: src/blocklist/fake-news.txt
    publish: docs/files/blocklist-ubo/fake-news.txt
    type: ubo
    data:
      headers: |
        Title: Fake News Filters
        Description: Filter for fake news sites. (For reference)
            This list is slightly organized from several sources only and is NOT actively maintained.
        Expires: 3 days
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ubo/fake-news.txt
      processors: *content_farms_processors_ubo
      schemes: *content_farms_schemes_ubo

  - source: src/blocklist/scam-sites.txt
    publish: docs/files/blocklist-ubo/scam-sites.txt
    type: ubo
    data:
      headers: |
        Title: Scam Sites Filters
        Description: Filter for scam sites. (For reference)
            This list is slightly organized from the database of ContenFarm Filter and Critic
            (https://github.com/xianshengyou8/filterfarm) and is NOT actively maintained.
        Expires: 3 days
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ubo/scam-sites.txt
      processors: *content_farms_processors_ubo
      schemes: *content_farms_schemes_ubo

  - source:
      - src/blocklist/content-farms.txt
      - src/aggregations/content-farms/
    publish: docs/files/blocklist-ublacklist/content-farms.txt
    type: ublacklist
    data:
      headers: |
        Title: Content Farm Filters
        Description: Filter for general content farms, mostly in Chinese.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ublacklist/content-farms.txt
      processors: &content_farms_processors_ublacklist
        - type: domain
          pattern: ^\*\.([\w.-]+)$
          replacement: domain-suffix:\1
        - type: domain
          pattern: ^([\w-]+)\.blogspot\.\*$
          replacement: blogspot:\1
      schemes: &content_farms_schemes_ublacklist
        <<: *content_farms_schemes
        domain-part:
          <<: *grouping_regex_scheme
          value: /https?://(?:[\w-]+\.)*(?:{value})(?:\.[\w-]+)*(?=[:\/?#]|$)/
        domain-path:
          value: "*://*.{value}\n*://*.{value}/*"
          mode: raw
        domain-suffix:
          <<: *grouping_regex_scheme
          value: /https?://(?:www\.|(?!www\.))[\w.-]+\.(?:{value})(?=[:/?#]|$)/
        blogspot:
          <<: *grouping_regex_scheme
          value: /https?://(?:[\w-]+\.)*(?:{value})\.blogspot\.(?:[\w.-]+)(?=[:\/?#]|$)/

  - source:
      - src/blocklist/nearly-content-farms.txt
      - src/aggregations/nearly-content-farms/
    publish: docs/files/blocklist-ublacklist/nearly-content-farms.txt
    type: ublacklist
    data:
      headers: |
        Title: Nearly Content Farm Filters
        Description: Filter for content-farm-like sites, mostly in Chinese.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ublacklist/nearly-content-farms.txt
      processors: *content_farms_processors_ublacklist
      schemes: *content_farms_schemes_ublacklist

  - source:
      - src/blocklist/bad-cloners.txt
      - src/aggregations/bad-cloners/
    publish: docs/files/blocklist-ublacklist/bad-cloners.txt
    type: ublacklist
    data:
      headers: |
        Title: Bad Cloners
        Description: Filter for cloner sites that are mostly free of copyright issue since the source site
            is copyleft or copyfree, but provide only trivial layout change or poor-quality bot translation
            and are thus spam-like.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ublacklist/bad-cloners.txt
      processors: *content_farms_processors_ublacklist
      schemes: *content_farms_schemes_ublacklist

  - source: src/blocklist/fake-news.txt
    publish: docs/files/blocklist-ublacklist/fake-news.txt
    type: ublacklist
    data:
      headers: |
        Title: Fake News Filters
        Description: Filter for fake news sites. (For reference)
            This list is slightly organized from several sources only and is NOT actively maintained.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ublacklist/fake-news.txt
      processors: *content_farms_processors_ublacklist
      schemes: *content_farms_schemes_ublacklist

  - source: src/blocklist/scam-sites.txt
    publish: docs/files/blocklist-ublacklist/scam-sites.txt
    type: ublacklist
    data:
      headers: |
        Title: Scam Sites Filters
        Description: Filter for scam sites. (For reference)
            This list is slightly organized from the database of ContenFarm Filter and Critic
            (https://github.com/xianshengyou8/filterfarm) and is NOT actively maintained.
        Last modified: {now}
        Homepage: https://danny0838.github.io/content-farm-terminator/
        Licence: MIT License
        Source: https://danny0838.github.io/content-farm-terminator/files/blocklist-ublacklist/scam-sites.txt
      processors: *content_farms_processors_ublacklist
      schemes: *content_farms_schemes_ublacklist

  - source: src/url-transform-rules/content-farms.txt
    publish: docs/files/url-transform-rules/content-farms.txt
    type: copy

  - source: src/url-transform-rules/sns-content-farms.txt
    publish: docs/files/url-transform-rules/sns-content-farms.txt
    type: copy
